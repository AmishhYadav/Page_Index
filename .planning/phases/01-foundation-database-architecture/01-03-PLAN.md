---
wave: 2
depends_on: ["01-01-PLAN.md"]
files_modified: ["app/services/embeddings.py", "app/core/logger.py", "app/main.py"]
autonomous: true
requirements: ["INF-02", "INF-03"]
---

# Plan 01-03: Embeddings Interface & Observability

## Goal
Abstract embedding provider interface (no hardcoded dims) and implement generalized observability logging wrapper.

<tasks>
  <task id="1" title="Abstract Embedding Provider">
    <description>Create `app/services/embeddings.py` containing an abstract base class `EmbeddingProvider` with abstract methods `get_dimension() -> int` and `embed(texts: List[str]) -> List[List[float]]`. Implement a dummy or default configurable subclass based on `EMBEDDING_MODEL_NAME` config.</description>
  </task>
  <task id="2" title="Configure JSON Logging">
    <description>Create `app/core/logger.py`. Setup standard Python logging using `python-json-logger` to format logs as JSON. Ensure `request_id` contextvar is used if present.</description>
  </task>
  <task id="3" title="FastAPI Logging Middleware">
    <description>Add a middleware in `app/main.py` that generates a new UUID `request_id` per request, sets it in `contextvars`, and logs request start/end latency as structured JSON.</description>
  </task>
</tasks>

<verification>
1. Calling a mock API endpoint generates structured JSON logs containing a `request_id` and latency details.
2. The embedding abstract class successfully allows overriding the dimensionality dynamically.
</verification>

<must_haves>
- System structured logs for observability.
- Request IDs injected into the logging context.
- Embedding interface abstracting away exact models.
</must_haves>
