# Plan 03-01: Implement Retrieval Service

## Goal
Implement the `RetrievalService` to perform hierarchical semantic search across Qdrant and PostgreSQL.

<tasks>
  <task id="1" title="Create RetrievalService">
    <description>Create `app/services/retrieval.py`. Implement `search(query, top_k)` which:
    1. Embeds the query.
    2. Performs vector search in Qdrant collection `sections`.
    3. Fetches `Section`, `Page`, and `Document` records from PostgreSQL for the returned IDs.
    4. Returns a list of structured objects containing text and metadata.</description>
  </task>
  <task id="2" title="Unit Test for Retrieval">
    <description>Create `test_03_01.py`. Mock the embedding and Qdrant calls to verify that the service correctly fetches and joins PostgreSQL data based on UUIDs.</description>
  </task>
</tasks>

<verification>
1. `RetrievalService` returns a list of results where each item has full Page and Document context.
2. postgres queries use the exact UUIDs returned from the vector search.
</verification>

<must_haves>
- Retrieval must return the `Document.filename` and `Page.page_number` for every hit.
- Must handle cases where Qdrant returns IDs that (unexpectedly) don't exist in Postgres.
</must_haves>
